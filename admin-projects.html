<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Ngăn chặn lập chỉ mục trang admin -->
    <meta name="robots" content="noindex, nofollow">
    <title>Admin - Quản lý Dự án</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- CSS Inline -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .admin-container { max-width: 900px; margin: 2rem auto; padding: 2rem; background-color: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input[type="text"], textarea { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; margin-bottom: 1rem; }
        textarea { min-height: 80px; }
        .project-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px dashed #e5e7eb; }
        .project-item:last-child { border-bottom: none; }
        .delete-btn { background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer; }
        .generate-btn { background-color: #16a34a; color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; display: block; text-align: center; margin-top: 1.5rem; }
        #outputCode { width: 100%; min-height: 200px; font-family: monospace; font-size: 0.8rem; background-color: #1f2937; color: #d1d5db; border: 1px solid #4b5563; border-radius: 0.375rem; padding: 0.5rem; margin-top: 1rem; white-space: pre; overflow-x: auto; }
        .warning { background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a; padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 1.5rem; font-size: 0.9rem; }
        .copy-btn { background-color: #4f46e5; color: white; padding: 0.3rem 0.8rem; border-radius: 0.375rem; font-size: 0.8rem; cursor: pointer; margin-left: 1rem; }
    </style>
</head>
<body>

    <div class="admin-container" id="admin-content" style="display: none;">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">Quản lý Dự án</h1>

        <div class="warning">
            <p><strong>Cảnh báo:</strong> Trang này chỉ dành cho quản trị viên. Mật khẩu không an toàn.</p>
            <p class="mt-1"><strong>Quy trình cập nhật:</strong> Thêm/Xóa dự án ➔ Nhấn "Tạo Mã Dữ liệu Mới" ➔ Copy toàn bộ mã trong ô bên dưới ➔ Mở file <code>assets/js/project-data.js</code> ➔ Xóa hết nội dung cũ, dán nội dung mới vào ➔ Lưu file và commit/push lên GitHub.</p>
            <p class="mt-1"><strong>Lưu ý ảnh:</strong> Bạn phải tự tải ảnh lên thư mục <code>assets/images/</code> trong kho Git và dán đường dẫn tương đối (ví dụ: <code>assets/images/ten-anh.jpg</code>) vào ô "URL Hình ảnh".</p>
        </div>

        <!-- Form Thêm Dự án -->
        <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-lg font-semibold mb-3 text-gray-700">Thêm Dự án Mới</h2>
            <form id="add-project-form">
                <div>
                    <label for="new-title">Tiêu đề:</label>
                    <input type="text" id="new-title" required>
                </div>
                <div>
                    <label for="new-category">Thể loại:</label>
                    <input type="text" id="new-category" required>
                </div>
                <div>
                    <label for="new-description">Mô tả:</label>
                    <textarea id="new-description" required></textarea>
                </div>
                <div>
                    <label for="new-imageUrl">URL Hình ảnh (ví dụ: assets/images/ten-anh.jpg):</label>
                    <input type="text" id="new-imageUrl" required>
                </div>
                 <div>
                    <label for="new-link">Link dự án (bỏ trống nếu không có):</label>
                    <input type="text" id="new-link">
                </div>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Thêm Dự án</button>
            </form>
        </div>

        <!-- Danh sách Dự án Hiện tại -->
        <div>
            <h2 class="text-lg font-semibold mb-3 text-gray-700">Danh sách Dự án Hiện Tại</h2>
            <div id="project-list">
                <!-- Danh sách sẽ được chèn vào đây -->
                <p class="text-gray-500">Đang tải...</p>
            </div>
        </div>

        <!-- Nút Tạo Mã & Ô Hiển thị Mã -->
        <div>
            <button id="generate-code-btn" class="generate-btn">Tạo Mã Dữ liệu Mới</button>
            <div id="output-section" style="display: none;">
                 <label for="outputCode" class="block mt-4 mb-2 font-medium">Mã JavaScript cho file <code>project-data.js</code> (Copy toàn bộ):
                    <button id="copy-code-btn" class="copy-btn">Copy</button>
                </label>
                <textarea id="outputCode" readonly></textarea>
                <p id="copy-status" class="text-sm text-green-600 mt-1 h-4"></p>
            </div>
        </div>
    </div>

    <!-- Script dữ liệu gốc (phải có trước script admin) -->
    <!-- Đảm bảo file này tồn tại và đúng đường dẫn -->
    <script src="assets/js/project-data.js"></script>

    <!-- JavaScript Inline -->
    <script>
        // Mật khẩu đơn giản (RẤT KHÔNG AN TOÀN)
        const ADMIN_PASSWORD = "admin"; // Đổi mật khẩu này!

        document.addEventListener('DOMContentLoaded', () => {
            // Xác thực đơn giản
            const enteredPassword = prompt("Nhập mật khẩu quản trị:", "");
            if (enteredPassword !== ADMIN_PASSWORD) {
                alert("Sai mật khẩu!");
                document.body.innerHTML = '<p class="text-center text-red-600 mt-10">Truy cập bị từ chối.</p>';
                return; // Dừng thực thi script nếu sai mật khẩu
            }
            // Hiển thị nội dung nếu đúng mật khẩu
            const adminContent = document.getElementById('admin-content');
            if (adminContent) adminContent.style.display = 'block';

            // Lấy các element cần thiết
            const projectListDiv = document.getElementById('project-list');
            const addProjectForm = document.getElementById('add-project-form');
            const generateCodeBtn = document.getElementById('generate-code-btn');
            const outputSection = document.getElementById('output-section');
            const outputCodeTextarea = document.getElementById('outputCode');
            const copyCodeBtn = document.getElementById('copy-code-btn');
            const copyStatus = document.getElementById('copy-status');

            // Kiểm tra xem biến projectsData có tồn tại không
            if (typeof projectsData === 'undefined') {
                 console.error("Lỗi: Không tìm thấy biến 'projectsData'. Kiểm tra file 'assets/js/project-data.js'.");
                 if(projectListDiv) projectListDiv.innerHTML = '<p class="text-red-500 font-bold">Lỗi nghiêm trọng: Không thể tải dữ liệu dự án.</p>';
                 // Vô hiệu hóa các nút nếu không có dữ liệu
                 if(addProjectForm) addProjectForm.querySelector('button[type="submit"]').disabled = true;
                 if(generateCodeBtn) generateCodeBtn.disabled = true;
                 return; // Dừng nếu không có dữ liệu gốc
            }

            // Sao chép dữ liệu gốc để thao tác
            let currentProjects = JSON.parse(JSON.stringify(projectsData)); // Deep copy

            // Hàm render danh sách dự án
            function renderProjectList() {
                if (!projectListDiv) return;
                projectListDiv.innerHTML = '';
                if (currentProjects.length === 0) {
                    projectListDiv.innerHTML = '<p class="text-gray-500">Chưa có dự án nào.</p>';
                    return;
                }
                currentProjects.forEach(project => {
                    const div = document.createElement('div');
                    div.className = 'project-item';
                    div.innerHTML = `
                        <span>
                            <strong class="text-gray-800">${escapeHtml(project.title) || 'Không có tiêu đề'}</strong>
                            <small class="text-gray-500 ml-2">(${escapeHtml(project.category) || 'Chưa phân loại'})</small>
                        </span>
                        <button class="delete-btn" data-id="${project.id}">Xóa</button>
                    `;
                    const deleteBtn = div.querySelector('.delete-btn');
                    if(deleteBtn) {
                        deleteBtn.addEventListener('click', () => {
                            if (confirm(`Bạn có chắc muốn xóa dự án "${project.title}"?`)) {
                                const projectId = parseInt(deleteBtn.getAttribute('data-id'));
                                currentProjects = currentProjects.filter(p => p.id !== projectId);
                                renderProjectList();
                                if (outputSection) outputSection.style.display = 'none';
                                if (copyStatus) copyStatus.textContent = '';
                            }
                        });
                    }
                    projectListDiv.appendChild(div);
                });
            }

            // Xử lý thêm dự án
            if (addProjectForm) {
                addProjectForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const titleInput = document.getElementById('new-title');
                    const categoryInput = document.getElementById('new-category');
                    const descriptionInput = document.getElementById('new-description');
                    const imageUrlInput = document.getElementById('new-imageUrl');
                    const linkInput = document.getElementById('new-link');

                    if (!titleInput || !categoryInput || !descriptionInput || !imageUrlInput || !linkInput) return;

                    const newProject = {
                        id: Date.now() + Math.floor(Math.random() * 100),
                        title: titleInput.value.trim(),
                        category: categoryInput.value.trim(),
                        description: descriptionInput.value.trim(),
                        imageUrl: imageUrlInput.value.trim(),
                        link: linkInput.value.trim() || '#'
                    };

                    if (!newProject.title || !newProject.category || !newProject.description || !newProject.imageUrl) {
                        alert("Vui lòng điền đủ Tiêu đề, Thể loại, Mô tả và URL Hình ảnh.");
                        return;
                    }

                    currentProjects.push(newProject);
                    renderProjectList();
                    addProjectForm.reset();
                    if (outputSection) outputSection.style.display = 'none';
                    if (copyStatus) copyStatus.textContent = '';
                });
            }

            // Xử lý tạo mã
            if (generateCodeBtn && outputCodeTextarea && outputSection) {
                generateCodeBtn.addEventListener('click', () => {
                    try {
                        let outputString = `// assets/js/project-data.js\n`;
                        outputString += `// Chứa danh sách các dự án. Mỗi dự án là một object.\n`;
                        outputString += `// QUAN TRỌNG: KHÔNG XÓA DÒNG \`const projectsData = \` VÀ DẤU \`];\` Ở CUỐI.\n`;
                        outputString += `// Chỉ chỉnh sửa nội dung bên trong dấu ngoặc vuông [...].\n`;
                        outputString += `// Copy toàn bộ nội dung từ trang admin và dán ĐÈ LÊN toàn bộ nội dung cũ của file này.\n\n`;
                        outputString += `const projectsData = [\n`;
                        outputString += currentProjects.map(p => `  ${JSON.stringify(p, null, 2)}`).join(',\n');
                        outputString += `\n];`;

                        outputCodeTextarea.value = outputString;
                        outputSection.style.display = 'block';
                        if (copyStatus) copyStatus.textContent = '';

                    } catch (error) {
                        console.error("Đã xảy ra lỗi khi tạo mã dữ liệu:", error);
                        alert("Đã xảy ra lỗi khi tạo mã. Vui lòng kiểm tra console (F12).");
                    }
                });
            } else {
                 console.error("Không tìm thấy nút 'generateCodeBtn' hoặc các thành phần output.");
                 if(generateCodeBtn) generateCodeBtn.disabled = true; // Vô hiệu hóa nếu thiếu element
            }

            // Xử lý nút Copy
            if (copyCodeBtn && outputCodeTextarea && copyStatus) {
                copyCodeBtn.addEventListener('click', () => {
                    outputCodeTextarea.select();
                    outputCodeTextarea.setSelectionRange(0, 99999);

                    try {
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText(outputCodeTextarea.value).then(() => {
                                copyStatus.textContent = 'Đã copy vào clipboard!';
                                setTimeout(() => { copyStatus.textContent = ''; }, 2000);
                            }).catch(err => {
                                console.error('Lỗi navigator.clipboard:', err);
                                fallbackCopyTextToClipboard(outputCodeTextarea.value, copyStatus);
                            });
                        } else {
                            fallbackCopyTextToClipboard(outputCodeTextarea.value, copyStatus);
                        }
                    } catch (err) {
                        console.error('Lỗi khi copy:', err);
                        copyStatus.textContent = 'Lỗi! Không thể copy.';
                        setTimeout(() => { copyStatus.textContent = ''; }, 2000);
                    }
                });
            }

            // Hàm fallback copy cho trình duyệt cũ
            function fallbackCopyTextToClipboard(text, statusElement) {
                var textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.position = "fixed";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    var successful = document.execCommand('copy');
                    var msg = successful ? 'Đã copy vào clipboard!' : 'Lỗi! Copy thất bại.';
                    if(statusElement) statusElement.textContent = msg;
                } catch (err) {
                    if(statusElement) statusElement.textContent = 'Lỗi! Copy thất bại.';
                     console.error('Lỗi document.execCommand:', err);
                }
                document.body.removeChild(textArea);
                if(statusElement) setTimeout(() => { statusElement.textContent = ''; }, 2000);
            }

            // Hàm escape HTML cơ bản
            function escapeHtml(unsafe) {
                if (typeof unsafe !== 'string') return unsafe; // Trả về nếu không phải string
                return unsafe
                     .replace(/&/g, "&amp;")
                     .replace(/</g, "&lt;")
                     .replace(/>/g, "&gt;")
                     .replace(/"/g, "&quot;")
                     .replace(/'/g, "&#039;");
             }

            // Render lần đầu
            renderProjectList();
        });
    </script>
</body>
</html>